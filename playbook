---
- name: Partition Creation
  hosts: all
  tasks:
    - name: Check If Disk Exists
      debug:
        msg: "Disk does not exists"
      when: "'sdb' not in ansible_facts['devices']"


    - name: Create Partition:
      block:
        - name: Create 1500M partition
          parted: 
            device: /dev/sdb
            number: 1
            state: present
            part_end: 1500MiB
          when: "'sdb' in ansible_facts['devices']"

        - name: Update Information
          setup:
            filter: ansible_facts['devices']

      rescue:
        - name: Checking Disk Space
          debug:
            msg: "Could not create partition of desired size"
          when: "'sdb' not in ansible_facts['devices']"


        - name: creae 850M partition
          parted:
            device: /dev/sdb
            number: 1
            state: present
            part_end: 850MiB
          when: "'sdb' in ansible_facts['devices']"


        - name: Update Information
          setup:
            filter: ansible_facts['devices']
      always:
        - name: create filesystem
          filesystem:
            device: /dev/sdb1
            fstype: ext4
          when: "'sdb1' in ansible_facts['devices']['sdb']['partitions']"

        - name: create directory
          file:
            path: /data
            state: directory

        - name: create mountpoint
          mount:
            src: /dev/sdb1
            path: /data
            state: present
          when: "'prod' in group_name"



i
